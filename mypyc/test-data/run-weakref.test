# Test cases for weakrefs (compile and run)

# TODO: fixme
[case testWeakrefRef-xfail]
from weakref import ref
from mypy_extensions import mypyc_attr

@mypyc_attr(native_class=False)
class Object:
    """some random weakreffable object"""
    pass

def test_weakref_ref() -> None:
    obj = Object()
    r = ref(obj)
    assert r() is obj
    obj = None
    assert r() is None, r()

def test_weakref_ref_with_callback() -> None:
    obj = Object()
    r = ref(obj, lambda x: x)
    assert r() is obj
    obj = None
    assert r() is None, r()
